## 概要
* 競馬で一着を当てる競馬予想AIモデルのソース
* スクレイピング処理含む

## 使い方
### スクレイピング
1. `src/config.py` を編集し、取得したい期間を年単位で編集
  * 例：
    ```py
    year_start = 2023
    year_end = 2024
    ```
2.  `src/main.py`を実行
  * ※出力ファイル名は適宜変えてください（`src/data_fetcher.py`）
    ```py
      # ファイル名の決定
      if test_mode: # テスト実行する場合はこちら
          filename = f'./data/{today}_keiba_racedata_{year}_test.csv'
      else:
          filename = f'./data/{today}_keiba_racedata_{year}.csv'
    ```
* ※テスト的に5レース分だけ取得出来るテスト実行モードもあります
  * `tests/test_scraping_5race.py`を実行してください
 
### モデルの作成と訓練
1. `notebooks/analysis_notebook.ipynb`の`########### 以下から、(1)~(6)を使ったランダムフォレスト ###########`と書いたセル以下から実行

## 設計について
`memo/設計メモ.md`参照

### 特徴量の各関数について
* (1)黄道座標と赤道座標の相互変換関数（3D座標変換、極座標と直行座標変換）
  * `src/coordinate_conversion.py`
* (2)「緯度経度年月日（（レース））を入力値、当該（レース）日時の日の出時刻からの経過時間、及び東の地平線の赤道座標を出力値」とする関数
  * `src/sunrise_calculator.py`
* (3)「当該（レース）日時の日の出時刻からの経過時間を入力値、黄道座標を出力値」とする関数
  * `src/sun_position_calculator.py`
* (4)「誕生日と当該日時を入力値、経過日数（と平均太陽時による年数）を出力値」とする関数
  * `src/age_calculator.py`
* (5)上記それぞれのテストコード
  * `tests/`配下
* (6)経過時刻と赤道座標変換関数
  * `src/elapsed_time_and_equatorial_conversion.py`

## 今の進捗
* 2023/12/20：
  * ランダムフォレストで、(1)〜(6)の関数を使ってモデルを生成し訓練し、一旦の評価をするところまで出来た
  * 1着の的中率 = 99.98902305159165 （過学習かも？）

## これから組み込むこと
* 精度を上げるための特徴量を生成して組み込む
```
馬の能力の判断方策
2着以下の場合、1着とのタイム差
1着の場合、2着3着とのタイム差
逃げ切り決着で、逃げ切った1着の場合、逃げ切り2,3着とのタイム差。逃げ切り場有利な展開で逃げ切った。
追い込み決着で、追い込んだ1着の場合、追い込み2,3着とのタイム差。追い込み場有利の展開で追い込んだ。

逃げ切り決着で、逃げ切った1着の場合、追い込み2,3着とのタイム差。他の逃げ切り場が脱落しても逃げ切った。
追い込み決着で、追い込んだ1着の場合、逃げ切り2,3着とのタイム差。他の追い込み場が脱落しても追い込んだ。
```
